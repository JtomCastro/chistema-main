<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reportes con Gráficos</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4 text-primary">📊 Reportes</h1>

    <!-- Botón para volver al Dashboard -->
    <div class="mb-3">
      <a href="/deshboard" class="btn btn-outline-primary">
        🏠 Volver al Dashboard
      </a>
    </div>

    <form action="/reportes" method="get" class="mb-4">
      <select name="tipo" class="form-select w-auto d-inline-block me-2">
        <option value="" <%= tipo === '' ? 'selected' : '' %>>Selecciona un reporte</option>
        <option value="ventas" <%= tipo === 'ventas' ? 'selected' : '' %>>Ventas por Cliente</option>
        <option value="productos-stock-bajo" <%= tipo === 'productos-stock-bajo' ? 'selected' : '' %>>
          Productos con Stock Bajo
        </option>
        <option value="proveedores" <%= tipo === 'proveedores' ? 'selected' : '' %>>
          Proveedores Activos/Inactivos
        </option>
      </select>
      <button type="submit" class="btn btn-primary">Mostrar</button>
    </form>

    <% if (!datosGrafico) { %>
      <p class="text-muted">Por favor, selecciona un tipo de reporte para mostrar el gráfico.</p>
    <% } else { %>
      <h3><%= datosGrafico.titulo %></h3>
      <canvas id="graficoReporte" width="600" height="400"></canvas>

      <script>
        const etiquetas = <%- JSON.stringify(datosGrafico.etiquetas) %>;
        const valores = <%- JSON.stringify(datosGrafico.valores) %>;
        const label = '<%= datosGrafico.label %>';

        const ctx = document.getElementById('graficoReporte').getContext('2d');

        // Seleccionar tipo de gráfico según el reporte
        let tipoGrafico = 'bar';
        if ('<%= tipo %>' === 'productos-stock-bajo') tipoGrafico = 'pie';

        const chart = new Chart(ctx, {
          type: tipoGrafico,
          data: {
            labels: etiquetas,
            datasets: [{
              label: label,
              data: valores,
              backgroundColor: [
                'rgba(255, 99, 132, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)'
              ],
              borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              tooltip: { enabled: true }
            },
            scales: tipoGrafico === 'bar' ? {
              y: { beginAtZero: true }
            } : {}
          }
        });
      </script>
    <% } %>
  </div>
</body>
</html>
