<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>üì¶ Historial de Movimientos de Inventario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h2 class="text-center text-primary mb-4">üìë Historial de Inventario</h2>

      <!-- Filtros -->
      <form class="row g-3 mb-4" method="get" action="/inventario/historial">
        <div class="col-md-4">
          <label class="form-label">Producto</label>
          <select name="producto_id" class="form-select">
            <option value="">-- Todos los productos --</option>
            <% productos.forEach(p => { %>
              <option value="<%= p.id %>" <%= filtro.producto_id == p.id ? 'selected' : '' %>>
                <%= p.nombre %>
              </option>
            <% }) %>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label">Tipo de Movimiento</label>
          <select name="tipo" class="form-select">
            <option value="">-- Todos --</option>
            <option value="ingreso" <%= filtro.tipo === 'ingreso' ? 'selected' : '' %>>Ingreso</option>
            <option value="egreso" <%= filtro.tipo === 'egreso' ? 'selected' : '' %>>Egreso</option>
            <option value="ajuste" <%= filtro.tipo === 'ajuste' ? 'selected' : '' %>>Ajuste</option>
          </select>
        </div>

        <div class="col-md-2">
          <label class="form-label">Desde</label>
          <input type="date" name="desde" class="form-control" value="<%= filtro.desde %>" />
        </div>

        <div class="col-md-2">
          <label class="form-label">Hasta</label>
          <input type="date" name="hasta" class="form-control" value="<%= filtro.hasta %>" />
        </div>

        <div class="col-md-1 d-flex align-items-end">
          <button class="btn btn-primary w-100">üîç Filtrar</button>
        </div>
      </form>

      <!-- Tabla -->
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle bg-white">
          <thead class="table-dark text-center">
            <tr>
              <th>Fecha</th>
              <th>Producto</th>
              <th>Tipo</th>
              <th>Cantidad</th>
              <th>Usuario Responsable</th>
              <th>Motivo</th>
            </tr>
          </thead>
          <tbody>
            <% if (movimientos.length === 0) { %>
              <tr>
                <td colspan="6" class="text-center text-muted">No se encontraron movimientos</td>
              </tr>
            <% } else { %>
              <% movimientos.forEach(m => { %>
                <tr>
                  <td><%= new Date(m.fecha_movimiento).toLocaleString() %></td>
                  <td><%= m.nombre_producto %></td>
                  <td>
                    <span class="badge bg-<%= m.tipo === 'ingreso' ? 'success' : m.tipo === 'egreso' ? 'danger' : 'warning' %>">
                      <%= m.tipo.charAt(0).toUpperCase() + m.tipo.slice(1) %>
                    </span>
                  </td>
                  <td class="text-center"><%= m.cantidad %></td>
                  <td><%= m.usuario %></td>
                  <td><%= m.motivo || '-' %></td>
                </tr>
              <% }) %>
            <% } %>
          </tbody>
        </table>
      </div>

      <a href="/deshboard" class="btn btn-secondary mt-4">‚¨Ö Volver al Dashboard</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
