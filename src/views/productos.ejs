<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Listado de Productos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }

      h1 {
        font-weight: 700;
      }

      .badge.bg-danger,
      .badge.bg-success,
      .badge.bg-secondary {
        font-weight: 600;
        font-size: 0.9rem;
        padding: 0.4em 0.7em;
        border-radius: 0.375rem;
      }

      td img.img-thumbnail {
        object-fit: cover;
        border-radius: 0.375rem;
      }

      td.text-center a.btn {
        margin: 0.15rem 0.15rem 0.15rem 0;
      }

      form input.form-control {
        height: 38px;
        font-size: 0.95rem;
        border-radius: 0.375rem;
        border: 1px solid #ced4da;
        transition: border-color 0.3s ease;
      }

      form input.form-control:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
      }

      form button.btn-primary {
        min-width: 110px;
        font-weight: 600;
      }

      form div > a.btn {
        min-width: 130px;
        font-weight: 600;
      }

      table.table {
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 0.125rem 0.25rem rgb(0 0 0 / 0.075);
      }

      thead.table-dark th {
        vertical-align: middle;
        font-size: 0.95rem;
        letter-spacing: 0.03em;
      }

      th.text-center {
        text-align: center !important;
      }

      tbody tr {
        height: 55px;
      }

      .table-responsive {
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <div
        class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3"
      >
        <h1 class="text-primary mb-0">📦 Listado de Productos</h1>
        <div class="d-flex flex-wrap gap-2">
          <a href="/productos/registrar" class="btn btn-success">
            ➕ Registrar Nuevo Producto
          </a>
          <a href="/deshboard" class="btn btn-outline-secondary">
            🔙 Volver al Dashboard
          </a>
        </div>
      </div>

      <!-- Filtros -->
      <form method="get" action="/productos" class="row g-3 mb-4">
        <div class="col-md-2 col-6">
          <input
            type="text"
            name="codigo"
            class="form-control"
            placeholder="Código"
          />
        </div>
        <div class="col-md-2 col-6">
          <input
            type="text"
            name="nombre"
            class="form-control"
            placeholder="Nombre"
          />
        </div>
        <div class="col-md-2 col-6">
          <input
            type="text"
            name="categoria"
            class="form-control"
            placeholder="Categoría"
          />
        </div>
        <div class="col-md-2 col-6">
          <input
            type="number"
            name="stock"
            class="form-control"
            placeholder="Stock ≥"
            min="0"
          />
        </div>
        <div class="col-md-2 col-6">
          <input
            type="number"
            name="precio"
            step="0.01"
            class="form-control"
            placeholder="Precio ≤"
            min="0"
          />
        </div>
        <div class="col-md-2 col-6">
          <input
            type="text"
            name="proveedor"
            class="form-control"
            placeholder="Proveedor"
          />
        </div>

        <div
          class="col-12 d-flex justify-content-between align-items-center flex-wrap gap-2"
        >
          <button type="submit" class="btn btn-primary">🔍 Filtrar</button>
          <div class="d-flex flex-wrap gap-2">
            <a href="/productos/exportar/excel" class="btn btn-success"
              >📊 Exportar Excel</a
            >
            <a href="/productos/exportar/pdf" class="btn btn-danger"
              >📄 Exportar PDF</a
            >
          </div>
        </div>
      </form>

      <!-- Tabla de productos -->
      <div class="table-responsive">
        <table
          class="table table-bordered table-hover align-middle bg-white text-nowrap"
        >
          <thead class="table-dark text-center">
            <tr>
              <th>Código</th>
              <th>Nombre</th>
              <th>Descripción</th>
              <th>Categoría</th>
              <th>Precio</th>
              <th>Cantidad</th>
              <th>Estado Stock</th>
              <th>Estado</th>
              <th>Proveedor</th>
              <th>Imagen</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <% productos.forEach(producto => { %>
            <tr>
              <td><%= producto.codigo %></td>
              <td><%= producto.nombre %></td>
              <td><%= producto.descripcion %></td>
              <td><%= producto.categoria_nombre || 'N/A' %></td>
              <td class="text-end">
                S/ <%= Number(producto.precio).toFixed(2) %>
              </td>
              <td class="text-center"><%= producto.stock %></td>
              <td class="text-center">
                <% if (producto.stock <= 10) { %>
                <span class="badge bg-danger">Crítico</span>
                <% } else { %>
                <span class="badge bg-success">Normal</span>
                <% } %>
              </td>
              <td class="text-center">
                <span
                  class="badge bg-<%= producto.estado === 'activo' ? 'success' : 'secondary' %>"
                >
                  <%= producto.estado %>
                </span>
              </td>
              <td><%= producto.proveedor_nombre || 'N/A' %></td>
              <td class="text-center">
                <a
                  href="/uploads/<%= producto.imagen || 'default.jpg' %>"
                  target="_blank"
                >
                  <img
                    src="/uploads/<%= producto.imagen || 'default.jpg' %>"
                    alt="Imagen de <%= producto.nombre %>"
                    width="60"
                    height="60"
                    class="img-thumbnail"
                  />
                </a>
              </td>
              <td class="text-center">
                <a
                  href="/productos/editar/<%= producto.id %>"
                  class="btn btn-sm btn-warning"
                  title="Editar Producto"
                  >✏️ Editar</a
                >
                <a
                  href="/productos/eliminar/<%= producto.id %>"
                  onclick="return confirm('¿Estás seguro de eliminar este producto?')"
                  class="btn btn-sm btn-danger"
                  title="Eliminar Producto"
                  >🗑️ Eliminar</a
                >
                <a
                  href="/productos/egreso/<%= producto.id %>"
                  class="btn btn-sm btn-outline-primary mt-1"
                  title="Registrar Egreso"
                  >📤 Egreso</a
                >
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
