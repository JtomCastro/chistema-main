<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title><%= venta.tipo_comprobante.toUpperCase() %> - VentasAlex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f4f6f8;
        font-family: "Segoe UI", sans-serif;
        font-size: 1.1rem;
      }

      .boleta {
        max-width: 850px;
        margin: auto;
        background: white;
        padding: 2.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      .empresa-info {
        text-align: center;
        border-bottom: 3px solid #0d6efd;
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
      }

      .empresa-info h2 {
        font-weight: bold;
        font-size: 2rem;
        color: #0d6efd;
      }

      .empresa-info p {
        margin: 0;
        font-size: 1rem;
        color: #444;
      }

      h3.text-primary {
        font-size: 1.8rem;
        font-weight: 600;
      }

      .table th {
        font-size: 1rem;
        background-color: #e9ecef;
      }

      .table td {
        font-size: 1.05rem;
      }

      .badge {
        font-size: 1rem;
        padding: 0.5em 1em;
      }

      .table-success {
        background-color: #d4edda !important;
      }

      .totales-table td {
        font-size: 1.1rem;
      }

      .acciones button,
      .acciones a {
        font-size: 1rem;
        padding: 0.6rem 1.2rem;
      }

      @media print {
        .no-print {
          display: none;
        }

        body {
          background-color: white !important;
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
        }

        .boleta {
          box-shadow: none;
          padding: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <div class="boleta">
        <div class="empresa-info">
          <h2>VentasAlex ðŸ›’</h2>
          <p>RUC: 20123456789</p>
          <p>DirecciÃ³n: Jr. Ayacucho 12121</p>
          <p>TelÃ©fono: 999999999</p>
        </div>

        <h3 class="text-center text-uppercase text-primary">
          <%= venta.tipo_comprobante === 'boleta' ? 'Boleta de Venta' :
          venta.tipo_comprobante === 'factura' ? 'Factura' : 'Nota de CrÃ©dito'
          %>
        </h3>

        <hr />

        <div class="row mb-4">
          <div class="col-6">
            <p>
              <strong><i class="bi bi-person"></i> Cliente:</strong> <%=
              cliente.nombres %>
            </p>
            <p>
              <strong><i class="bi bi-card-text"></i> Documento:</strong> <%=
              cliente.documento %>
            </p>
            <% if (cliente.telefono) { %>
            <p>
              <strong><i class="bi bi-telephone"></i> TelÃ©fono:</strong> <%=
              cliente.telefono %>
            </p>
            <% } %> <% if (cliente.email) { %>
            <p>
              <strong><i class="bi bi-envelope"></i> Email:</strong> <%=
              cliente.email %>
            </p>
            <% } %>
          </div>
          <div class="col-6 text-end">
            <p>
              <strong><i class="bi bi-calendar"></i> Fecha:</strong> <%= new
              Date(venta.fecha_venta).toLocaleDateString('es-PE') %>
            </p>
            <p>
              <strong><i class="bi bi-clock"></i> Hora:</strong> <%= new
              Date(venta.fecha_venta).toLocaleTimeString('es-PE') %>
            </p>
            <% if (venta.numero_orden) { %>
            <p>
              <strong><i class="bi bi-hash"></i> NÂ° Orden:</strong> <%=
              venta.numero_orden %>
            </p>
            <% } %>
            <p>
              <strong>Comprobante:</strong> <%=
              venta.tipo_comprobante.toUpperCase() %>
            </p>
            <p><strong>ID Venta:</strong> #<%= venta.id %></p>
          </div>
        </div>

        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Producto</th>
              <th class="text-center">Precio Unit.</th>
              <th class="text-center">Cantidad</th>
              <th class="text-end">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <% productos.forEach(p => { %>
            <tr>
              <td><%= p.nombre_producto %></td>
              <td class="text-center">
                S/ <%= parseFloat(p.precio_unitario).toFixed(2) %>
              </td>
              <td class="text-center"><%= p.cantidad %></td>
              <td class="text-end">
                S/ <%= parseFloat(p.subtotal_producto).toFixed(2) %>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>

        <div class="row justify-content-end">
          <div class="col-md-6">
            <table class="table totales-table">
              <tr>
                <td><strong>Subtotal:</strong></td>
                <td class="text-end">
                  S/ <%= parseFloat(venta.subtotal_general).toFixed(2) %>
                </td>
              </tr>
              <tr>
                <td><strong>IGV (18%):</strong></td>
                <td class="text-end">
                  S/ <%= parseFloat(venta.impuesto_total).toFixed(2) %>
                </td>
              </tr>
              <tr class="table-success">
                <td><strong>TOTAL:</strong></td>
                <td class="text-end">
                  <strong>S/ <%= parseFloat(venta.total).toFixed(2) %></strong>
                </td>
              </tr>
            </table>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-md-6">
            <p>
              <strong>Forma de Pago:</strong> <%= venta.forma_pago.toUpperCase()
              %>
            </p>
            <% if (venta.monto_pagado && parseFloat(venta.monto_pagado) > 0) {
            %>
            <p>
              <strong>Monto Pagado:</strong> S/ <%=
              parseFloat(venta.monto_pagado).toFixed(2) %>
            </p>
            <p>
              <strong>Cambio Devuelto:</strong> S/ <%=
              parseFloat(venta.cambio_devuelto || 0).toFixed(2) %>
            </p>
            <% } %>
          </div>
          <div class="col-md-6 text-end">
            <p>
              <strong>Estado:</strong>
              <span class="badge bg-success"
                ><%= venta.estado.toUpperCase() %></span
              >
            </p>
          </div>
        </div>

        <div class="text-center mt-4 text-muted">
          <small>Â¡Gracias por su compra!</small><br />
          <small>Conserve este comprobante</small>
        </div>

        <div
          class="no-print mt-4 d-flex flex-wrap justify-content-center gap-3 acciones"
        >
          <button class="btn btn-outline-success" onclick="window.print()">
            <i class="bi bi-printer"></i> Imprimir
          </button>
          <a
            class="btn btn-outline-info"
            href="/ventas/enviarPdfWhatsApp/<%= venta.id %>"
            target="_blank"
          >
            <i class="bi bi-whatsapp"></i> WhatsApp
          </a>
          <a
            class="btn btn-outline-warning"
            href="/ventas/enviarPdfEmail/<%= venta.id %>"
            target="_blank"
          >
            <i class="bi bi-envelope-paper"></i> Email
          </a>
          <a href="/ventas" class="btn btn-secondary"
            ><i class="bi bi-arrow-left"></i> Volver</a
          >
        </div>
      </div>
    </div>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get("exito") === "1") {
      Swal.fire({
        icon: "success",
        title: "Â¡Venta registrada!",
        text: "La venta se ha registrado correctamente.",
        confirmButtonText: "Aceptar",
      });
    }
  </script>
</html>
